#  1주차 과제: JVM은 무엇이며 자바 코드는 어떻게 실행하는 것인가.

## 목표

자바 소스 파일(.java)을 JVM으로 실행하는 과정 이해하기.

## 학습할 것

- JVM이란 무엇인가
- 컴파일 하는 방법
- 실행하는 방법
- 바이트코드란 무엇인가
- JIT 컴파일러란 무엇이며 어떻게 동작하는지
- JVM 구성 요소
- JDK와 JRE의 차이



## JVM이란?

자바 가상 머신(JVM, Java Virtual Machine)은 Java Byte Code를 OS에 맞게 해석 해주는 역할을 합니다. Java compiler는 `.java` 파일을 `.class`라는 Java byte code로 변환 시켜 줍니다. Byte Code는 기계어가 아니기 때문에OS에서 바로 실행되지 않습니다. 

이때 JVM은 OS가 ByteCode를 이해할 수 있도록 해석 해줍니다. **Byte Code는 JVM 위에서 OS상관없이 실행된다**.는 점이 Java의 가장 큰 장점이라고 할수 있습니다. OS에 종속적이지 않고 Java 파일 하나만 만들면 어느 디바이스든 JVM 위에서 실행 할 수 있습니다.



> #### **자바 바이트 코드(Java bytecode)**
>
> 자바 바이트 코드(Java bytecode)란 자바 가상 머신이 이해할 수 있는 언어로 변환된 자바 소스 코드를 의미합니다.
>
> 자바 컴파일러에 의해 변환되는 코드의 명령어 크기가 1바이트라서 자바 바이트 코드라고 불리고 있습니다.
>
> 이러한 자바 바이트 코드의 확장자는 .class입니다.
>
> 자바 바이트 코드는 자바 가상 머신만 설치되어 있으면, 어떤 운영체제에서라도 실행될 수 있습니다.





> #### **JRE와 JDK**
>
> **Jre(Java Runtime Environment)**
>
> 자바 애플리케이션의 실행 환경이다. 이미 컴파일된 자바 애플리케이션의 모듈(JAR 파일과 클래스 파일 등)을 이용하여 실행할 수 있다.
>
> JDK(Java Development Kit)
>
> 자바 애플리케이션의 개발 환경이다. 실행 환경뿐만 아니라 소스 파일의 컴파일러 및 디버거 등 자바 애플리케이션을 개발하기 위한 도구가 포함되어 있다.
>
> 애플리케이션을 JRE가 있으면 작동시킬 수 있다. 단, 운영할때 디버깅 및 분석 등을 하고자 하는 경우에는 jdk에 들어있는 도구가 필요하다. 따라서 서버 등의 운영 환경에 설치하는 경우에도 JRE보다는 JDK를 선택하는 것이 좋은 경우도 있다.









## JVM의 구성

### Class Loader

JVM내로 클래스 파일을 로드하고 링크를 통해 JVM의 메모리에 적재하는 작업을 수행합니다.

### Execution Engine

`.class`는 실행 엔진을 통해 JVM 내부에서 실행가능한 기계어로 번역되어 실행되게 됩니다.

이때, 명령어를 하나씩 실행하는 `인터프리터(Interpreter) `방식과 ` JIT(Just In Time) Compiler`를 이용하는 방식이 있습니다.

- **Interpreter**

  명령어 단위로 읽어서 수행하기 때문에 느리다라는 단점이 있습니다.

- **JIT Compiler**

  바이트 코드 전체를 컴파일하여 네이티브 코드로 변경하고, 캐시에 저장합니다. 그렇기 때문에 한 번 컴파일된 코드는 빠르게 수행하게 됩니다.

### Garbage Collector

Garbage Colector는 Heap메모리 영역에 생성(적재)된 객체들 중에 참조되지 않는 객체들을 탐색 후 제거하는 역할을 합니다.

GC는 참조가 없어지자마자 해제되는 것을 보장하지 핞으며 GC가 역할을 하는 시간은 정확히 언제인지를 알 수 없습니다.

또한 GC가 수행되는 동안 GC를 수행하는 Thread가 아닌 다른 모든 Thread가 일시정지 됩니다.특히, Full GC가 일어나서 수 초간 모든 Thread가 정지한다면 장애로 이어지는 치명적인 문제가 생길 수 있습니다.

### Runtime Data Area

JVM의 메모리 영역으로 JAVA Application을 수행하기 위해 OS로부터 할당받은 메모리 영역을 의미합니다. 



---



![img](C:\Users\Kiyeon Han\Documents\GIT\TIL\JAVA\01 JVM은 무엇이며 자바 코드는 어떻게 실행하는 것인가.assets\java-jvm-01.png)

>#### **자바 프로그램 실행과정**
>
>1. 개발자가 자바 소스코드(.java)를 작성합니다.
>
>2. 프로그램이 실행되면 JVM은 OS로부터 메모리를 할당 받습니다.
>
>3. javac컴파일러가 자바 소스파일을 컴파일 합니다. 이때 자바 소스파일은 바이트 코드(.class)로 자바 가상머신이 이해할 수 있는 코드로 변환되게 됩니다.
>
>4. 컴파일된 바이트 코드는 JVM의 클래스로더에게 전달됩니다.
>
>5. 클래스 로더는 자바 클래스 파일과 필요한 라이브러리파일을 로딩 및 링크하여 JVM 메모리에 올립니다.
>
>6. 로딩된 바이트 코드는 실행앤진을 통해 기계어로 번역되며 프로그램이 실행됩니다. 이때 실행 엔진은 두가지 방식으로 동작합니다.
>
>  7. 인터프리터
>
>     바이트 코드 명령어를 하나씩 읽어 해석하고 실행합니다. 
>
>  8. JIT 컴파일러
>
>     인터프리터 방식의 단점을 보안하기 위해 도입된 방법으로 바이트 코드 전채를 컴파일하여 바이너리 코드로 변경하는 방식입니다.
>
>9. 실행 과정중 JVM은 필요에 따라 스레드 동기화와 GC의 작업을 수행합니다.





## JVM의 메모리 구조

![img](C:\Users\Kiyeon Han\Documents\GIT\TIL\JAVA\01 JVM은 무엇이며 자바 코드는 어떻게 실행하는 것인가.assets\java-jvm-02.png)

> JAVA는 멀티 스레드환경으로 모든 스레드는 **Heap과 Meathod** 영역을 공유하게 됩니다.



### 메소드(Method) 영역

모든 스레드가 공유하는 영역으로 JVM이 시작될 때 생성된다. JVM이 읽어 들인 **각각의 클래스와 인터페이스에 대한 런타임 상수 풀, 필드와 메서드 정보, Static 변수등을 저장**하는 영역이다.

### 힙(Heap) 영역

**new 명령어로 생성된 인스턴스와 객체가 저장되는 영역**입니다.

Garbage Collector가 참조되지 않은 메모리를 확인하고 제거하는 주요 대상입니다.

### 스텍(Stack) 영역

**지역 변수, 파라미터, 리턴 값, 연산에 사용되는 임시 값 등을 저장하는 영역**입니다. 

스텍 영역은 각 스레드마다 하나씩 존재하며 스래드가 시작될 때 생성된다. 스텍 프레임(Stack Frame)라는 구조체를 저장하며 메소드가 호출될때 메모리에 할당되며 종료되면 메모리가 해제된다.

### PC Register

스레드가 시작될 때 생성되며 해당 스레드가 실행되는 부분의 주소와 명령을 저장하고 있습니다.

### Native Method Stack

JAVA 이외의 언어로 작성된 Method의 정보가 저장되는 공간입니다.

JNI(Java Native Interface)를 통해 호출되는 C/C++등의 코드를 수행하기 위한 스택으로 바이트 코드로 저장됩니다.


